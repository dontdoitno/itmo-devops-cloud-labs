## –ó–∞–¥–∞—á–∞

–°–¥–µ–ª–∞—Ç—å –∫—Ä–∞—Å–∏–≤–æ —Ä–∞–±–æ—Ç—É —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥–Ω—è—Ç—å Hashicorp Vault (–∏–ª–∏ –¥—Ä—É–≥—É—é —Å–µ–∫—Ä–µ—Ç–æ—Ö—Ä–∞–Ω–∏–ª–∫—É) –∏ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã ci/cd –ø–∞–π–ø–ª–∞–π–Ω (–∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –≤–∞—à —Å–µ—Ä–≤–∏—Å) —Ö–æ–¥–∏–ª —Ç—É–¥–∞, –±—Ä–∞–ª —Å–µ–∫—Ä–µ—Ç, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –µ–≥–æ –Ω–µ —Å–≤–µ—Ç—è –≤ –ª–æ–≥–∞—Ö. –í Readme –∞—Ä–≥—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—á–µ–º—É –≤–∞—à —Å–ø–æ—Å–æ–± –∫—Ä–∞—Å–∏–≤—ã–π, –∞ —Ç–∞–∫–∂–µ –æ–ø–∏—Å–∞—Ç—å, –ø–æ—á–µ–º—É —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ CI/CD –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ö–æ—Ä–æ—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π.

## –†–µ—à–µ–Ω–∏–µ

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è [—Ä–µ–ø–∞](https://github.com/dontdoitno/devops_lab_3_star), —á—Ç–æ–±—ã —Å–ª—É—á–∞–π–Ω–æ –Ω–µ –Ω–∞–≤–æ—Ä–æ—Ç–∏—Ç—å –¥–µ–ª–æ–≤ —Å –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–ø–æ–π. –í –∫–∞—á–µ—Å—Ç–≤–µ —Å–µ–∫—Ä–µ—Ç–æ—Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –±—ã–ª –≤—ã–±—Ä–∞–Ω `Hashicorp Vault`. –ï—â—ë —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–ª–∏—Å—å –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å `Azure Key Vault` –∏ `AWS Secrets Manager`, –Ω–æ –æ–Ω–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –†–§ –∏ –¥–∞–∂–µ –Ω–µ –¥–∞—é—Ç –∞–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞—Ç—å. –í–æ–æ–±—â–µ —Ö–æ—Ç–µ–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å Dynamic secrets, –∫–æ—Ç–æ—Ä—ã–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø–æ –∑–∞–ø—Ä–æ—Å—É –∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑ (–¥–ª—è –ª—É—á—à–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏), –Ω–æ —ç—Ç–æ —Ç–æ–ª—å–∫–æ –∑–∞ –¥–µ–Ω—é–∂–∫—É üò¢.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `Hashicorp Vault`

–î–ª—è –Ω–∞—á–∞–ª–∞ –∫–∞—á–∞–µ–º –¥–æ–∫–µ—Ä –æ–±—Ä–∞–∑ `Hashicorp Vault` —á–µ—Ä–µ–∑
```bash
docker pull hashicorp/vault
```
(–∫–æ–º–∞–Ω–¥—É –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ `Dockerhub`, —Ç–∞–º –Ω—É–∂–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –µ—Å—Ç—å)

![](img/1.png)

–ø–æ—Ç–æ–º –∑–∞–ø—É—Å–∫–∞–µ–º `Vault` —á–µ—Ä–µ–∑ –¥–æ–∫–µ—Ä –∏ –Ω–∞—Å—Ç—Ä–æ–∏–≤–∞–µ–º –µ–≥–æ
```bash
docker run --cap-add=IPC_LOCK -e 'VAULT_DEV_ROOT_TOKEN_ID=myroot' -e 'VAULT_DEV_LISTEN_ADDRESS=0.0.0.0:8200' -p 8200:8200 vault:1.14.0
```

![](img/2.png)

–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–µ–Ω –ª–∏ `Vault` –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –∞–¥—Ä–µ—Å–µ `http://127.0.0.1:8200`, –∑–∞–æ–¥–Ω–æ –ª–æ–≥–∏–Ω–∏–º—Å—è –ø–æ —Ç–æ–∫–µ–Ω—É myroot:

![](img/3.png)
![](img/4.png)

–í—Å—ë –≥—É–¥, —Ä–∞–±–æ—Ç–∞–µ–º –¥–∞–ª—å—à–µ (ü¶í)

–ü–æ—Ç–æ–º –Ω–∞–¥–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `Vault` –ª–æ–∫–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å —Ç—É–¥–∞ —Å–µ–∫—Ä–µ—Ç—ã, –∏ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–µ–∫–Ω—É—Ç—å —Ä–µ–∞–ª—å–Ω–æ –ª–∏ –æ–Ω —É—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –∏–ª–∏ –≤—Å—ë –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ –∫–∞–∫ –Ω–∞–¥–æ:
```bash
brew tap hashicorp/tap
brew install hashicorp/tap/vault

vault -version
```

![](img/5.png)

![](img/6.png)

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–∞–∫–∏–¥—ã–≤–∞–µ–º –Ω–∞—à–∏ —Å–µ–∫—Ä–µ—Ç—ã:
```bash
export VAULT_ADDR=http://127.0.0.1:8200
export VAULT_TOKEN=myroot

vault kv put secret/app SECRET_KEY=my_secret_key DB_PASSWORD=my_db_password
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `Dockerfile` –∏ –ª–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ `Docker`

–î–ª—è –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—ã–ª –Ω–∞–ø–∏—Å–∞–Ω –ø—Ä–æ—Å—Ç–µ–Ω—å–∫–∏–π `Dockerfile`:
```Dockerfile
FROM python:3.9-slim

WORKDIR /app

COPY app/requirements.txt /app/

RUN pip install --no-cache-dir -r requirements.txt

COPY app /app

CMD ["python", "app.py"]
```

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä–∏–º —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä. –í –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º:
```bash
docker build -t flask-app .

docker run -p 4000:4000 flask-app  # 5000 –ø–æ—Ä—Ç –∑–∞–Ω—è—Ç –∏ –Ω–µ —Ö–æ—á–µ—Ç —É–±–∏–≤–∞—Ç—å—Å—è :(
```

–í—Å—ë –≥—É–¥, —É –Ω–∞—Å —Å–±–∏–ª–¥–∏–ª–æ—Å—å –∏ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å –Ω–∞ –∞–¥—Ä–µ—Å–µ `http://localhost:4000`:

![](img/7.png)

![](img/8.png)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `GitHub Secrets`

–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–∞ `GitHub` –Ω–∞—Å—Ç—Ä–æ–∏–≤–∞–µ–º —Å–µ–∫—Ä–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –ø–æ–¥—Ç—è–≥–∏–≤–∞—Ç—å—Å—è –¥–ª—è `workflow`:

> VAULT_ADDR: http://127.0.0.1:8200
> VAULT_TOKEN: myroot
> DOCKER_USERNAME: —é–∑–µ—Ä–Ω–µ–π–º Docker Hub
> DOCKER_PASSWORD: –ø–∞—Ä–æ–ª—å Docker Hub

![](img/11.png)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `GitHub Actions Workflow`

–ú—ã —Ö–æ—Ç–∏–º –∑–∞–∫–∏–Ω—É—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ –Ω–∞—à–µ–π –∞–ø–ø–∫–æ–π –Ω–∞ `Docker Hub`, —ç—Ç–∏–º –∏ –∑–∞–π–º—ë–º—Å—è.
–í —Ä–µ–ø–µ —Å–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª–∏–∫ `.github/workflows/deploy.yml`
```yaml
name: Build and Deploy

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y jq curl

    - name: Fetch secrets from Vault
      env:
        VAULT_ADDR: ${{ secrets.VAULT_ADDR }}
        VAULT_TOKEN: ${{ secrets.VAULT_TOKEN }}
      run: |
        # –ü–æ–ª—É—á–∞–µ–º —Å–µ–∫—Ä–µ—Ç—ã –∏–∑ Vault
        SECRET_KEY=$(curl -s --header "X-Vault-Token: $VAULT_TOKEN" \
          $VAULT_ADDR/v1/secret/data/app | jq -r '.data.data.SECRET_KEY')
        DB_PASSWORD=$(curl -s --header "X-Vault-Token: $VAULT_TOKEN" \
          $VAULT_ADDR/v1/secret/data/app | jq -r '.data.data.DB_PASSWORD')

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ–∫—Ä–µ—Ç—ã –≤ —Ñ–∞–π–ª—ã
        echo "$SECRET_KEY" > secret_key.txt
        echo "$DB_PASSWORD" > db_password.txt

    - name: Build Docker image
      run: |
        docker build -t ${{ secrets.DOCKER_USERNAME }}/myapp:latest .

    - name: Login to Docker Hub
      run: |
        echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin

    - name: Push Docker image
      run: |
        docker push ${{ secrets.DOCKER_USERNAME }}/myapp:latest
```

–∏ –≤—Å—ë –ø—É—à–∏–º –Ω–∞ `GitHub`. –û–Ω —Å–∞–º –Ω–∞—á–∏–Ω–∞–µ—Ç –¥–∂–æ–±—ã –¥–µ–ø–ª–æ—è, –º–æ–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å—ë –ø—Ä–æ—à–ª–æ –≥—É–¥:

![](img/9.png)

–ù—É –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º –∫–∞–∫ —Ç–∞–º –¥–µ–ª–∞ –Ω–∞ `Docker Hub`:

![](img/10.png)

–ù–∞—à –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞–ª–∏–ª—Å—è –Ω–∞ `Docker Hub`, –º–æ–∂–Ω–æ –ø–æ—Ä–∞–¥–æ–≤–∞—Ç—å—Å—è –∏ –±–µ–∂–∞—Ç—å –ø–∏—Å–∞—Ç—å –æ—Ç—á—ë—Ç–∏–∫. ü¶í

### –ü–æ—á–µ–º—É —Ä–µ—à–µ–Ω–∏–µ —Ö–æ—Ä–æ—à–µ–µ?

> **–≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ**. –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –∞ –Ω–µ –≤ —Ä–µ–ø–µ –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –¥–æ–±—Ä–∞—Ç—å—Å—è –¥–æ –Ω–∏—Ö —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–ª–æ–∂–Ω–µ–µ + —Å–µ–∫—Ä–µ—Ç—ã –≤ `HashiCorp Vault` —à–∏—Ñ—Ä—É—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ (`TLS`) –∏ –ø—Ä–∏ —Ö—Ä–∞–Ω–µ–Ω–∏–∏, –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –∏—Ö —Å–ª–æ–∂–Ω–æ

> **–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ**. –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å `GitHub Actions`, —Ç–æ –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—Ç—è–≥–∏–≤–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç—ã –∏–∑ `HashiCorp Vault`

> **–≠—Ç–æ –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ**. –ï—Å—Ç—å —Ç–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ + –µ—Å–ª–∏ –∏–∑–º–µ–Ω—è—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –≤ `HashiCorp Vault`, —Ç–æ –æ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–º–µ–Ω—è—Ç—Å—è –≤ –ø–∞–π–ø–ª–∞–π–Ω–µ

> **–≠—Ç–æ –≥–∏–±–∫–æ**. `HashiCorp Vault` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ª–æ–∫–∞–ª—å–Ω–æ, –≤ –æ–±–ª–∞–∫–µ –∏–ª–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ

> **–≠—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ –†–§**. –¢–æ–ª—å–∫–æ `HashiCorp Vault` –ø–æ–∑–≤–æ–ª–∏–ª –∑–∞—Ä–µ–≥–µ—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –±—É–¥—É—á–∏ —Ä–µ–∑–∏–¥–µ–Ω—Ç–æ–º –†–§. –ù–∞—Å—á—ë—Ç —Ä–∞–±–æ—Ç—ã –Ω–µ –∑–Ω–∞—é, VPN –Ω–æ–Ω-—Å—Ç–æ–ø –≤–∫–ª—é—á–µ–Ω......

## –í—ã–≤–æ–¥—ã

–°–ø–∞—Å–∏–±–æ –∑–∞ –ª–∞–±—É, –±—ã–ª–æ –∑–∞–±–∞–≤–Ω–æ –∏ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ, –æ—Å–æ–±–µ–Ω–Ω–æ —Å–≤—è–∑–∞—Ç—å –¥–æ–∫–µ—Ä + —Å–µ–∫—Ä–µ—Ç—ã + –ø–∞–π–ø–ª–∞–π–Ω –∏ –≤—Å—ë –∑–∞–∫–∏–Ω—É—Ç—å –≤ –≤–æ—Ä–∫—Ñ–ª–æ—É –≥–∏—Ç—Ö–∞–±–∞.

–¢–µ–ø–µ—Ä—å —Å–º–µ–ª–æ –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≤ —Ä–µ–∑—é–º–µ —Å—Ç—Ä–æ—á–∫—É "–µ—Å—Ç—å –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π nginx, Docker –∏ CI/CD".

# ü¶í
